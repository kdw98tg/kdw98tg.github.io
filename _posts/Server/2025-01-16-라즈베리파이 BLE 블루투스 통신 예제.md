---
title: "[Raspberrypi/Linux] RaspberryPi/Linux ì—ì„œ ë¸”ë£¨íˆ¬ìŠ¤ ì €ì „ë ¥(BLE) ì„œë²„ ì˜ˆì œ"

categories:
  -  Server
  
tags:
  - [Raspberrypi, Window, Bluetooth]

toc: true
toc_sticky: true

published: true

date: 2025-01-16
last_modified_at: 2025-01-16
---

## ë¼ì¦ˆë² ë¦¬íŒŒì´ ì„¤ì •

ë¼ì¦ˆë² ë¦¬íŒŒì´ ì„¤ì •ë²• ì…ë‹ˆë‹¤. BlueZ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ëŠ” ì˜ˆì œ ì…ë‹ˆë‹¤.

BlueZë€ Linuxì˜ ê³µì‹ ë¸”ë£¨íˆ¬ìŠ¤ í”„ë¡œí† ì½œ ìŠ¤íƒ ì…ë‹ˆë‹¤.

BLEì™€ í´ë˜ì‹ì„ ëª¨ë‘ ì§€ì›í•˜ë©°, bluetoothd ë¼ëŠ” ë°ëª¬(ì„œë¹„ìŠ¤)ë¥¼ í†µí•´ ì¥ì¹˜ë¥¼ ì œì–´í•©ë‹ˆë‹¤.

ì„¤ì¹˜ í›„, ë²„ì „ì„ í™•ì¸í•˜ì—¬ ì„¤ì¹˜ê°€ ë˜ì—ˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.

```bash
bluetoothctl -v
# ë˜ëŠ”
dpkg -s bluez | grep Version
```

### ë¼ì¦ˆë² ë¦¬íŒŒì´ OSì— íŒ¨í‚¤ì§€ ì„¤ì¹˜

- ë¼ì¦ˆë² ë¦¬ íŒŒì´ëŠ” 3Bë²„ì „ ë¶€í„° ë¸”ë£¨íˆ¬ìŠ¤ ëª¨ë“ˆì´ ë‚´ì¥ë˜ì–´ ë³„ë„ ë™ê¸€ì´ í•„ìš” ì—†ìŠµë‹ˆë‹¤.
- ë¸”ë£¨íˆ¬ìŠ¤ ê´€ë ¨ íŒì›¨ì–´/ë“œë¼ì´ë²„ê°€ í¬í•¨ë˜ì–´ ìˆê¸° ë•Œë¬¸ì—, ìœ„ ëª…ë ¹ìœ¼ë¡œ BlueZë¥¼ ì„¤ì¹˜í•˜ë©´ ëŒ€ë¶€ë¶„ ë™ì‘í•©ë‹ˆë‹¤.
- bluez : ë¸”ë£¨íˆ¬ìŠ¤ í”„ë¡œí† ì½œ ìŠ¤íƒ
- bluez-tools : `bluetoothctl`, `hciconfig` ë“±ì˜ ëª…ë ¹ì–´ë¥¼ í¬í•¨

```bash
sudo apt-get update
sudo apt-get install -y bluez bluez-tools
```

### BLuetooth ë°ëª¬ í™œì„±í™” / í™•ì¸

ë°ëª¬ì€ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ëŒì•„ê°€ëŠ” ì„œë¹„ìŠ¤ë¥¼ ë§í•©ë‹ˆë‹¤. ë‹¤ìŒ ëª…ë ¹ì–´ë“¤ë¡œ ìƒíƒœë¥¼ í™•ì¸ í•©ë‹ˆë‹¤.

```bash
systemctl status bluetooth
```

- ìƒíƒœê°€ active(running) ì´ë©´ ì •ìƒ.
- ë§Œì•½ `inactive`, `failed`ê°€ ëœ¨ë©´ ë‹¤ìŒì˜ ëª…ë ¹ì–´ë¥¼ ì…ë ¥ í•©ë‹ˆë‹¤.

```bash
sudo systemctl start bluetooth
sudo systemctl enable bluetooth  # ë¶€íŒ… ì‹œ ìë™ ì‹œì‘
```

### Bluetoothctl ëª…ë ¹ì–´ë¡œ ì„¤ì •í•˜ê¸°

bluetoothctl ì€ bluetooth ì„¤ì •ì„ ë‹´ë‹¹í•˜ëŠ” ëª…ë ¹ì–´ ì…ë‹ˆë‹¤.

```bash
bluetoothctl
```

ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì¹˜ë©´ í„°ë¯¸ë„ì˜ ê²½ë¡œê°€ `[bluetooth]`ë¡œ ë°”ë€Œê²Œ ë©ë‹ˆë‹¤.

 `show` ëª…ë ¹ì–´ë¥¼ ì¹˜ë©´ í˜„ì¬ ë¸”ë£¨íˆ¬ìŠ¤ì˜ ìƒíƒœë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 

```bash
[bluetooth]# show
```

ìƒíƒœë¥¼ ë³´ê³  í•„ìš”í•œ ê²ƒë“¤ì„ ì•„ë˜ì˜ ëª…ë ¹ì–´ë¥¼ ì°¸ê³ í•´ì„œ ì¼œì¤ë‹ˆë‹¤.

```bash
[bluetooth]# power on           # ì–´ëŒ‘í„° ì „ì› ì¼œê¸°
[bluetooth]# power off          # ì–´ëŒ‘í„° ì „ì› ë„ê¸°
[bluetooth]# pairable on        # í˜ì–´ë§ í—ˆìš©
[bluetooth]# pairable off
[bluetooth]# discoverable on    # ì¥ì¹˜ ê²€ìƒ‰(Discoverable) í—ˆìš©
[bluetooth]# discoverable off
[bluetooth]# agent on           # í˜ì–´ë§ ì—ì´ì „íŠ¸ í™œì„±í™”
[bluetooth]# default-agent      # ê¸°ë³¸ ì—ì´ì „íŠ¸ë¡œ ì„¤ì •
```

**ì—¬ê¸°ì„œ ì¤‘ìš”í•œ ê²ƒì€ ë§Œì•½ `discoverable`ì´ off ê°€ ë˜ì–´ìˆë‹¤ë©´, ë¸”ë£¨íˆ¬ìŠ¤ë¥¼ ì•„ë¬´ë¦¬ ê²€ìƒ‰í•´ë„ ê²€ìƒ‰ì´ ë˜ì§€ ì•Šìœ¼ë‹ˆ ë°˜ë“œì‹œ ì¼œì¤˜ì•¼ í•©ë‹ˆë‹¤.**

## BLEë¥¼ í™œìš©í•œ ì„œë²„(Peripheral) êµ¬ì¶•í•˜ê¸°

ì˜ˆì œëŠ” ì •ë§ ë§ì´ ë¨¸ë¦¬ë¥¼ ë°•ì•˜ìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‹¤ê°€ bluez-peripheral ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ ê³µì‹ ë¬¸ì„œë¥¼ ë³´ê³  í•´ê²°í•˜ì˜€ìŠµë‹ˆë‹¤.

ğŸ‘‰ğŸ‘‰ğŸ‘‰[bluez-peripheral ê³µì‹ë¬¸ì„œ](https://pypi.org/project/bluez-peripheral/)

ìš°ì„ , íŒ¨í‚¤ì§€ë“¤ì„ ì„¤ì¹˜í•´ ì¤ë‹ˆë‹¤.

```bash
sudo apt-get install -y python3 python3-pip
pip install bluez-peripheral
```

ë‹¤ìŒì€ ì„œë²„ì—ì„œ BLEë¡œ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ 1ì´ˆë§ˆë‹¤ `hello` ë¼ëŠ” ë¬¸ìë¥¼ ë³´ë‚´ëŠ” ì˜ˆì œ ì…ë‹ˆë‹¤.

```python
# hello_service.py
from bluez_peripheral.gatt.service import Service
from bluez_peripheral.gatt.characteristic import characteristic, CharacteristicFlags as CharFlags
import asyncio

class HelloService(Service):
    def __init__(self):
        super().__init__("180D", True)  # Heart Rate Service UUID

    @characteristic("2A37", CharFlags.NOTIFY)
    def hello_characteristic(self, options):
        pass

    async def update_hello(self):
        while True:
            message = "Hello!"
            self.hello_characteristic.changed(message.encode("utf-8"))
            print(f"[Server] Notified: {message}")
            await asyncio.sleep(1)

```

```python
# main.py
import asyncio
from bluez_peripheral.util import get_message_bus, Adapter
from bluez_peripheral.advert import Advertisement
from bluez_peripheral.agent import NoIoAgent
from hello_service import HelloService

async def main():
    bus = await get_message_bus()
    service = HelloService()
    await service.register(bus)

    agent = NoIoAgent()
    await agent.register(bus)

    adapter = await Adapter.get_first(bus)
    advert = Advertisement("MyBLE", ["180D"], 0x0340, 60)
    await advert.register(bus, adapter)

    await service.update_hello()
    await bus.wait_for_disconnect()

if __name__ == "__main__":
    asyncio.run(main())

```

ì´ë ‡ê²Œ í•˜ê³ , ì•„ë˜ì˜ ëª…ë ¹ì–´ë¡œ main.pyë¥¼ ì‹¤í–‰ì‹œí‚µë‹ˆë‹¤.

```bash
python main.py
```

## ìì£¼ ë°œìƒí•˜ëŠ” ë¬¸ì œë“¤

### Discoverableì´ ìë™ìœ¼ë¡œ êº¼ì§

- ì¼ë¶€ ë°°í¬íŒì—ì„œ `discoverable-timeout`ì´ ì„¤ì •ë˜ì–´ ìˆìŒ.
- `sudo bluetoothctl discoverable on`ì„ ì‹¤í–‰í•´ë„ ì¼ì • ì‹œê°„ í›„ êº¼ì§ˆ ìˆ˜ ìˆìœ¼ë‹ˆ, `sudo vim /etc/bluetooth/main.conf`ì—ì„œ `DiscoverableTimeout = 0`ìœ¼ë¡œ ì„¤ì •í•´ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. (ì¬ë¶€íŒ… í›„ ì ìš©)

### ì—°ê²° ì‹œ Permission Denied í˜¹ì€ Unreachable

- ê´€ë¦¬ì ê¶Œí•œìœ¼ë¡œ ì‹¤í–‰í•˜ì§€ ì•Šì€ ê²½ìš°.
- ë˜ëŠ” OS ì—…ë°ì´íŠ¸/BlueZ ë²„ì „ ì°¨ì´ë¡œ ì¸í•´ í˜ì–´ë§/ë³´ì•ˆ ì •ì±…ì´ ë°”ë€Œì—ˆì„ ìˆ˜ ìˆìŒ.

### ë‹¤ë¥¸ ì¥ì¹˜ê°€ BLE ìŠ¤ìºë‹ ì‹œ ì¥ì¹˜ê°€ ì•ˆ ëœ¸

 - `hciconfig`ë‚˜ `bluetoothctl show`ì—ì„œ `POWERED: yes`ì¸ì§€, `DISCOVERABLE: yes`ì¸ì§€ ì¬í™•ì¸.
 - `advertise` ëª…ë ¹ì´ë‚˜ `bluez_peripheral` ê°™ì€ ë°©ë²•ìœ¼ë¡œ ê´‘ê³ ë¥¼ ì˜¬ë°”ë¥´ê²Œ ì¼°ëŠ”ì§€ ì²´í¬.
### GATT ì„œë¹„ìŠ¤ ê²€ìƒ‰ ì‹¤íŒ¨

 - ê¸°ê¸°ê°€ ê´‘ê³ ëŠ” í•˜ê³  ìˆìœ¼ë‚˜ GATT ì„œë²„ê°€ ì œëŒ€ë¡œ ì˜¬ë¼ì˜¤ì§€ ì•Šì•˜ê±°ë‚˜, ì„œë¹„ìŠ¤ UUIDê°€ ì˜ëª»ë˜ì—ˆëŠ”ì§€ í™•ì¸.
 - Windows/Android/iOS BLE ìŠ¤ìºë„ˆ ì•±(nRF Connect, LightBlue ë“±)ìœ¼ë¡œ GATT ì„œë¹„ìŠ¤ë¥¼ í™•ì¸í•´ ë³´ëŠ” ê²Œ ì¢‹ìŠµë‹ˆë‹¤.
### ë¼ì¦ˆë² ë¦¬ íŒŒì´ OS ì—…ë°ì´íŠ¸ í›„ ë™ì‘ ë‹¬ë¼ì§

 - BlueZ ë²„ì „ì´ ë³€ê²½ë˜ë©´ì„œ, ê¸°ì¡´ ì„¤ì •ì´ ë‹¬ë¼ì¡Œì„ ìˆ˜ ìˆìŒ.
 - `/etc/bluetooth/main.conf`ë‚˜ `systemd` ì„œë¹„ìŠ¤ ì„¤ì •ì„ ë‹¤ì‹œ í™•ì¸í•´ì•¼ í•©ë‹ˆë‹¤.

## í´ë¼ì´ì–¸íŠ¸ ì½”ë“œ

í´ë¼ì´ì–¸íŠ¸ ì½”ë“œëŠ” ë‹¤ìŒ ë§í¬ë¥¼ ì°¸ê³ í•´ ì£¼ì„¸ìš”.

ğŸ‘‰ğŸ‘‰ğŸ‘‰[í´ë¼ì´ì–¸íŠ¸ ì½”ë“œ - ë§ˆì‹œë‚¨ì˜ ê¸°ìˆ ë¸”ë¡œê·¸](https://kdw98tg.github.io/winform/Winform-BLE-%ED%86%B5%EC%8B%A0/)
